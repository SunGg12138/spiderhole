#!/usr/bin/env node
const fs = require('fs-extra');
const m3u8 = require('../m3u8');
const program = require('commander');
const rp = require('request-promise');
program
    .option('-p, --path <path>', '本地的m3u8路径')
    .option('-u, --url <url>', 'm3u8文件的url')
    .option('-tsp, --ts-path <ts_path>', 'ts基础路径')
    .option('-n, --name <name>', '导出文件的名字')
    .parse(process.argv);

main();

async function main () {
    const { name, url, path, ts_path } = program.opts();
    if (!url && !path) throw new Error('url 和 path 必须二选一');

    // 获取m3u8文件内容
    const m3u8_txt = path? await fs.readFile(path) : await rp(url);

    // 开始爬取数据
    m3u8.spider(name, m3u8_txt, ts_path);
}
